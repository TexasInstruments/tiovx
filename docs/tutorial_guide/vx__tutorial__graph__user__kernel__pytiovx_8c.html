<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>TIOVX Tutorials: vx_tutorial_graph_user_kernel_pytiovx.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ti_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">TIOVX Tutorials
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('vx__tutorial__graph__user__kernel__pytiovx_8c.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">vx_tutorial_graph_user_kernel_pytiovx.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;VX/vx.h&gt;</code><br/>
<code>#include &lt;TI/tivx.h&gt;</code><br/>
<code>#include &lt;<a class="el" href="utility_8h_source.html">utility.h</a>&gt;</code><br/>
<code>#include &lt;ch03_graph/vx_tutorial_graph_user_kernel_pytiovx_uc.h&gt;</code><br/>
<code>#include &lt;<a class="el" href="phase__rgb__user__kernel_8h_source.html">ch03_graph/phase_rgb_user_kernel.h</a>&gt;</code><br/>
</div>
<p><a href="vx__tutorial__graph__user__kernel__pytiovx_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a8118656bb5a60090a1dbffa402168438"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vx__tutorial__graph__user__kernel__pytiovx_8c.html#a8118656bb5a60090a1dbffa402168438">IN_FILE_NAME</a>&#160;&#160;&#160;&quot;colors.bmp&quot;</td></tr>
<tr class="memdesc:a8118656bb5a60090a1dbffa402168438"><td class="mdescLeft">&#160;</td><td class="mdescRight">Input file name.  <a href="#a8118656bb5a60090a1dbffa402168438">More...</a><br/></td></tr>
<tr class="separator:a8118656bb5a60090a1dbffa402168438"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a858679d8af857cbb2c1346f4a4bc1c06"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vx__tutorial__graph__user__kernel__pytiovx_8c.html#a858679d8af857cbb2c1346f4a4bc1c06">OUT_USER_KERNEL_FILE_NAME</a>&#160;&#160;&#160;&quot;vx_tutorial_graph_user_kernel_pytiovx_out.bmp&quot;</td></tr>
<tr class="memdesc:a858679d8af857cbb2c1346f4a4bc1c06"><td class="mdescLeft">&#160;</td><td class="mdescRight">Output file name when tutorial is run with user kernel.  <a href="#a858679d8af857cbb2c1346f4a4bc1c06">More...</a><br/></td></tr>
<tr class="separator:a858679d8af857cbb2c1346f4a4bc1c06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a1d52660f6cc470b9da80d5589808fc"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vx__tutorial__graph__user__kernel__pytiovx_8c.html#a9a1d52660f6cc470b9da80d5589808fc">OUT_TARGET_KERNEL_FILE_NAME</a>&#160;&#160;&#160;&quot;vx_tutorial_graph_target_kernel_pytiovx_out.bmp&quot;</td></tr>
<tr class="memdesc:a9a1d52660f6cc470b9da80d5589808fc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Output file name when tutorial is run with target kernel.  <a href="#a9a1d52660f6cc470b9da80d5589808fc">More...</a><br/></td></tr>
<tr class="separator:a9a1d52660f6cc470b9da80d5589808fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a08ebb111969e2e91e4d36366d138d6ea"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vx__tutorial__graph__user__kernel__pytiovx_8c.html#a08ebb111969e2e91e4d36366d138d6ea">vx_tutorial_graph_user_kernel_pytiovx</a> (vx_bool add_as_target_kernel)</td></tr>
<tr class="memdesc:a08ebb111969e2e91e4d36366d138d6ea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tutorial Entry Point.  <a href="#a08ebb111969e2e91e4d36366d138d6ea">More...</a><br/></td></tr>
<tr class="separator:a08ebb111969e2e91e4d36366d138d6ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Show example usage of using user kernel in larger graph.</p>
<p>In the tutorial we learn below concepts,</p>
<ul>
<li>Use the user/target kernel defined in tutorial <a class="el" href="vx__tutorial__graph__user__kernel_8c.html">vx_tutorial_graph_user_kernel.c</a> in a larger graph</li>
<li>Specify the user defined kernel in .py file in using PyTIOVX APIs</li>
<li>Generate the graph code using the user defined kernel and other built-in kernels using the PyTIOVX APIs.</li>
</ul>
<p>When using PyTIOVX tool, first create a .py file which describes the OpenVX graph. Follow comments in <a class="el" href="vx__tutorial__graph__user__kernel__pytiovx__uc_8py.html">vx_tutorial_graph_user_kernel_pytiovx_uc.py</a> to understand the graph description basic API. In this example, we also use the PyTIOVX API to define a user defined kernel. This allows user to add their own kernels to the tool without having to modify deep within the tool.</p>
<p>Next PyTIOVX tool is run to generate .c/.h file for the graph described in .py file. A .jpg file which shows the graph visually is also generated in the process.</p>
<p>Follow steps mentioned in PyTIOVX user guide <a href="../pytiovx_guide/index.html" target="_blank">[HTML]</a> to install and run the PyTIOVX tool. See also additional APIs provided to describe a graph via PyTIOVX.</p>
<p>For this example, run below command to generate the code and image file </p>
<div class="fragment"><div class="line">python vx_tutorial_graph_user_kernel_pytiovx_uc.py</div>
</div><!-- fragment --><p>Include the generated C code API header file </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;ch03_graph/vx_tutorial_graph_user_kernel_pytiovx_uc.h&gt;</span></div>
</div><!-- fragment --><p> Note, that the generated file name and APIs use as prefix the string name passed as input during context create in the .py file.</p>
<p>Follow the comments in the function <a class="el" href="vx__tutorial__graph__user__kernel__pytiovx_8c.html#a08ebb111969e2e91e4d36366d138d6ea" title="Tutorial Entry Point. ">vx_tutorial_graph_user_kernel_pytiovx()</a> to complete the rest of tutorial code to invoke the generated OpenVX graph.</p>
<p><b> NOTE: </b> <br/>
 The implementation on HOST side for user kernel and target kernel is largely the same. Any difference in implementation between user kernel and target kernel is shown by using using boolen variable 'add_as_target_kernel'.</p>
<ul>
<li>When 'add_as_target_kernel' is 'vx_false_e', it is the implementation for user kernel.</li>
<li>When 'add_as_target_kernel' is 'vx_true_e', it is the implementation for target kernel.</li>
</ul>
<p>Include below file to use the HOST callable interface for the user/target kernel </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="phase__rgb__user__kernel_8h.html">ch03_graph/phase_rgb_user_kernel.h</a>&gt;</span></div>
</div><!-- fragment --> 
<p>Definition in file <a class="el" href="vx__tutorial__graph__user__kernel__pytiovx_8c_source.html">vx_tutorial_graph_user_kernel_pytiovx.c</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a8118656bb5a60090a1dbffa402168438"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IN_FILE_NAME&#160;&#160;&#160;&quot;colors.bmp&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Input file name. </p>

<p>Definition at line <a class="el" href="vx__tutorial__graph__user__kernel__pytiovx_8c_source.html#l00124">124</a> of file <a class="el" href="vx__tutorial__graph__user__kernel__pytiovx_8c_source.html">vx_tutorial_graph_user_kernel_pytiovx.c</a>.</p>

</div>
</div>
<a class="anchor" id="a858679d8af857cbb2c1346f4a4bc1c06"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OUT_USER_KERNEL_FILE_NAME&#160;&#160;&#160;&quot;vx_tutorial_graph_user_kernel_pytiovx_out.bmp&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Output file name when tutorial is run with user kernel. </p>

<p>Definition at line <a class="el" href="vx__tutorial__graph__user__kernel__pytiovx_8c_source.html#l00127">127</a> of file <a class="el" href="vx__tutorial__graph__user__kernel__pytiovx_8c_source.html">vx_tutorial_graph_user_kernel_pytiovx.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9a1d52660f6cc470b9da80d5589808fc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OUT_TARGET_KERNEL_FILE_NAME&#160;&#160;&#160;&quot;vx_tutorial_graph_target_kernel_pytiovx_out.bmp&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Output file name when tutorial is run with target kernel. </p>

<p>Definition at line <a class="el" href="vx__tutorial__graph__user__kernel__pytiovx_8c_source.html#l00130">130</a> of file <a class="el" href="vx__tutorial__graph__user__kernel__pytiovx_8c_source.html">vx_tutorial_graph_user_kernel_pytiovx.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a08ebb111969e2e91e4d36366d138d6ea"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vx_tutorial_graph_user_kernel_pytiovx </td>
          <td>(</td>
          <td class="paramtype">vx_bool&#160;</td>
          <td class="paramname"><em>add_as_target_kernel</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Tutorial Entry Point. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">add_as_target_kernel</td><td>[in] 'vx_false_e', run this tutorial with custom kernel running as user kernel <br/>
 'vx_true_e', run this tutorial with custom kernel running as target kernel <br/>
</td></tr>
  </table>
  </dd>
</dl>
<ul>
<li>Define the data structure representing the generated OpenVX use-case code.</li>
</ul>
<p>This structure includes the context, data object, node, graph handles for the generated code. </p>
<div class="fragment"><div class="line">  /</div>
<div class="line">vx_tutorial_graph_user_kernel_pytiovx_uc_t uc;</div>
</div><!-- fragment --><ul>
<li>Define the OpenVX context</li>
</ul>
<div class="fragment"><div class="line">  /</div>
<div class="line">vx_context context = NULL;</div>
</div><!-- fragment --><ul>
<li>Specify the output file name</li>
</ul>
<p>In order to compare and confirm that the user kernel and target kernel generate the same output we specify a different output file for user and target kernel</p>
<div class="fragment"><div class="line">  /</div>
<div class="line"><span class="keywordtype">char</span> *out_file = <a class="code" href="vx__tutorial__graph__user__kernel_8c.html#a858679d8af857cbb2c1346f4a4bc1c06">OUT_USER_KERNEL_FILE_NAME</a>;</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">if</span>(add_as_target_kernel)</div>
<div class="line">{</div>
<div class="line">    out_file = <a class="code" href="vx__tutorial__graph__user__kernel_8c.html#a9a1d52660f6cc470b9da80d5589808fc">OUT_TARGET_KERNEL_FILE_NAME</a>;</div>
<div class="line">}</div>
</div><!-- fragment --><ul>
<li>Create OpenVX context</li>
</ul>
<p>Even though the generated use-case creates OpenVX context later, we create it here, so as to allow us to register the user/target kernel, before creating the OpenVX use-case </p>
<div class="fragment"><div class="line">  /</div>
<div class="line">context = vxCreateContext();</div>
</div><!-- fragment --><ul>
<li>Register user or target kernel into the OpenVX context</li>
</ul>
<p>This is required so that the user kernel or target can be invoked as any other node within an OpenVX graph. 'add_as_target_kernel' is used specify whether to register kernel as user kernel or target kernel.</p>
<p>This function is implemented in <a class="el" href="phase__rgb__user__kernel_8c.html">phase_rgb_user_kernel.c</a></p>
<p><b> Rest of the implementation post this is same for both user kernel and target kernel. </b> </p>
<div class="fragment"><div class="line">  /</div>
<div class="line">status = <a class="code" href="phase__rgb__user__kernel_8c.html#a5e51581ab691a0e9037aed069be8495b">phase_rgb_user_kernel_add</a>(context, add_as_target_kernel);</div>
<div class="line"><span class="keywordflow">if</span>(status!=VX_SUCCESS)</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot; vx_tutorial_graph_user_kernel_pytiovx: ERROR: unable to add user kernel !!!\n&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><ul>
<li>Create the OpenVX use-case using the generated create API.</li>
</ul>
<p>This creates the OpenVX context, data objects, nodes and graph for this use-case. <br/>
 NOTE: graph verify is not yet called. <br/>
 NOTE: Any customization like changing parameter values, loading data to data objects should be done next, before calling graph verify </p>
<div class="fragment"><div class="line">  /</div>
<div class="line">vx_tutorial_graph_user_kernel_pytiovx_uc_create(&amp;uc);</div>
</div><!-- fragment --><ul>
<li>Load input into input data reference</li>
</ul>
<p>NOTE: the data reference names in the use-case structure, match the name specified via name="xyz" in the .py file </p>
<div class="fragment"><div class="line">  /</div>
<div class="line">printf(<span class="stringliteral">&quot; Loading file %s ...\n&quot;</span>, <a class="code" href="vx__tutorial__image__load__save_8c.html#a8118656bb5a60090a1dbffa402168438">IN_FILE_NAME</a>);</div>
<div class="line">status = <a class="code" href="utility_8h.html#abb1f44b0f70eb1480ce3ed7dc7bf4e62">load_image_from_file</a>(uc.input, <a class="code" href="vx__tutorial__image__load__save_8c.html#a8118656bb5a60090a1dbffa402168438">IN_FILE_NAME</a>, vx_true_e);</div>
</div><!-- fragment --><ul>
<li>Print data object info for debug purposes <div class="fragment"><div class="line">  /</div>
<div class="line"><a class="code" href="utility_8h.html#ade45042efce712b30cf8254a6c90b3bc">show_image_attributes</a>(uc.input);</div>
<div class="line"><a class="code" href="utility_8h.html#ade45042efce712b30cf8254a6c90b3bc">show_image_attributes</a>(uc.grad_x);</div>
<div class="line"><a class="code" href="utility_8h.html#ade45042efce712b30cf8254a6c90b3bc">show_image_attributes</a>(uc.grad_y);</div>
<div class="line"><a class="code" href="utility_8h.html#ade45042efce712b30cf8254a6c90b3bc">show_image_attributes</a>(uc.phase);</div>
<div class="line"><a class="code" href="utility_8h.html#ade45042efce712b30cf8254a6c90b3bc">show_image_attributes</a>(uc.phase_rgb);</div>
</div><!-- fragment --></li>
<li>Call generated API to verify graphs present in this use-case</li>
</ul>
<p>Also prints graph info for debug purposes </p>
<div class="fragment"><div class="line">  /</div>
<div class="line">vx_tutorial_graph_user_kernel_pytiovx_uc_verify(&amp;uc);</div>
<div class="line"><a class="code" href="utility_8h.html#a86ae0d04d187710cc2d10f85bccb6e5d">show_graph_attributes</a>(uc.graph_0);</div>
</div><!-- fragment --> <pre class="fragment">export graph to dot file, which can be coverted to jpg using dot tool
</pre> <div class="fragment"><div class="line">  /</div>
<div class="line">tivxExportGraphToDot(uc.graph_0, <span class="stringliteral">&quot;.&quot;</span>, <span class="stringliteral">&quot;vx_tutorial_graph_user_kernel_pytiovx&quot;</span>);</div>
</div><!-- fragment --><ul>
<li>Call generated API to run graphs present in this use-case <div class="fragment"><div class="line">  /</div>
<div class="line">vx_tutorial_graph_user_kernel_pytiovx_uc_run(&amp;uc);</div>
</div><!-- fragment --></li>
<li>Print graph execution info, save output data to file <div class="fragment"><div class="line">  /</div>
<div class="line"><a class="code" href="utility_8h.html#a86ae0d04d187710cc2d10f85bccb6e5d">show_graph_attributes</a>(uc.graph_0);</div>
<div class="line"></div>
<div class="line">printf(<span class="stringliteral">&quot; Saving to file %s ...\n&quot;</span>, out_file);</div>
<div class="line"><a class="code" href="utility_8h.html#a2ffb77a8e510c0236b07306d0eb47a30">save_image_to_file</a>(out_file, uc.phase_rgb);</div>
</div><!-- fragment --></li>
<li>Call generated API to delete this use-case</li>
</ul>
<p>This releases the data objects, nodes, graphs and context associated with this use-case </p>
<div class="fragment"><div class="line">  /</div>
<div class="line">vx_tutorial_graph_user_kernel_pytiovx_uc_delete(&amp;uc);</div>
</div><!-- fragment --><ul>
<li>Unregister user/kernel from the context</li>
</ul>
<p>This function is implemented in <a class="el" href="phase__rgb__user__kernel_8c.html">phase_rgb_user_kernel.c</a> </p>
<div class="fragment"><div class="line">  /</div>
<div class="line"><a class="code" href="phase__rgb__user__kernel_8c.html#a25ca1ab2d5d29d7d84d81ddc366a464c">phase_rgb_user_kernel_remove</a>(context);</div>
</div><!-- fragment --><ul>
<li>Finally release the OpenVX context</li>
</ul>
<div class="fragment"><div class="line">  /</div>
<div class="line">vxReleaseContext(&amp;context);</div>
</div><!-- fragment --> 
<p>Definition at line <a class="el" href="vx__tutorial__graph__user__kernel__pytiovx_8c_source.html#l00138">138</a> of file <a class="el" href="vx__tutorial__graph__user__kernel__pytiovx_8c_source.html">vx_tutorial_graph_user_kernel_pytiovx.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_07c2df013bb20677b8e65a9f18968d2c.html">tutorial</a></li><li class="navelem"><a class="el" href="dir_307a8bb882813a7025380ea070a5f4d7.html">ch03_graph</a></li><li class="navelem"><a class="el" href="vx__tutorial__graph__user__kernel__pytiovx_8c.html">vx_tutorial_graph_user_kernel_pytiovx.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
