<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>PyTIOVX User Guide: PyTIOVX User Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ti_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PyTIOVX User Guide
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">PyTIOVX User Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section user"><dt>Overview</dt><dd>PyTIOVX Tool allows users to specify an OpenVX graph as Python code and use the PyTIOVX tool to generate C code with OpenVX APIs. Additionally, the PyTIOVX Tool allows users to generate an OpenVX extension kernel wrapper by specifying parameters of the kernel and setting relationships between these parameters. <br/>
<br/>
 'tiovx' is the python module that is used to specify OpenVX graph in a compact manner using predefined classes and objects. After specification of OpenVX graph using PyTIOVX APIs, it can be exported in various formats including C code, JPG image <br/>
<br/>
 Note: If running off repository, overwrite the PyTIOVX files tools/PyTIOVX/tiovx/core_extended.py and tools/PyTIOVX/tiovx/target_extended.py from tiovx_dev/internal_docs/PyTIOVX_Extended.</dd></dl>
<dl class="section user"><dt>Contents</dt><dd><ul>
<li><a class="el" href="index.html#INSTALLATION">Installation</a></li>
<li><a class="el" href="index.html#USAGE">Usage</a></li>
<li><a class="el" href="index.html#KERNEL_SCRIPT">Kernel Generation</a></li>
<li><a class="el" href="index.html#USE_CASE_SCRIPT">Use Case Generation</a></li>
</ul>
</dd></dl>
<p><br/>
</p>
<hr/>
<h1><a class="anchor" id="INSTALLATION"></a>
Installation</h1>
<ul>
<li>Install Python 3.5.2 or later (<a href="https://www.python.org/">https://www.python.org/</a>)<ul>
<li>To confirm "python" and "pip" are in your install path, type below <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;python3 --version</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;pip3 --version</div>
</div><!-- fragment --></li>
</ul>
</li>
<li>Install 'dot' tool provided as part of 'graphviz' (<a href="http://www.graphviz.org/">http://www.graphviz.org/</a>) <br/>
 'dot' is required to generated .JPG file for a OpenVX graph specification<ul>
<li>To confirm "dot" tool is in your install path, type <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;dot -V</div>
</div><!-- fragment --></li>
</ul>
</li>
<li>Install 'tiovx' python module by executing below command at folder "&lt;tiovx install path&gt;/tools/PyTIOVX" <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;sudo pip3 install -e .</div>
</div><!-- fragment --> Expected output, <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Obtaining file:///&lt;tiovx install path&gt;/tiovx/tools/PyTIOVX</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;Installing collected packages: tiovx</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  Running setup.py develop <span class="keywordflow">for</span> tiovx</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Successfully installed tiovx-0.1</div>
</div><!-- fragment --></li>
<li>Now tiovx python module can be imported and used in your python script by doing below, <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">from</span> tiovx <span class="keyword">import</span> *</div>
</div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="USAGE"></a>
Usage</h1>
<ul>
<li>Both modes of the PyTIOVX Tool usage (use case and kernel generation) are run in identical fashion as described below</li>
<li>Describe your application graph or kernel wrapper using PyTIOVX APIs in a .py file. Execute the .py file by invoking python <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;python my_use_case.py</div>
</div><!-- fragment --> Note: if the following error is observed, please run using the command "python3.5 my_use_case.py" <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Traceback (most recent call last):</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;    File <span class="stringliteral">&quot;kernel_generate_example.py&quot;</span>, line 6, <span class="keywordflow">in</span> &lt;module&gt;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;        <span class="keyword">from</span> tiovx <span class="keyword">import</span> *</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    File <span class="stringliteral">&quot;tiovx/__init__.py&quot;</span>, line 63, <span class="keywordflow">in</span> &lt;module&gt;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;        <span class="keyword">from</span> .enums <span class="keyword">import</span> *</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    File <span class="stringliteral">&quot;tiovx/tools/PyTIOVX/tiovx/enums.py&quot;</span>, line 62, <span class="keywordflow">in</span> &lt;module&gt;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;        <span class="keyword">from</span> enum <span class="keyword">import</span> Enum</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;ImportError: No module named enum</div>
</div><!-- fragment --></li>
<li>See also examples in TIOVX tutorial <a href="../tutorial_guide/index.html" target="_blank">[HTML]</a> for making OpenVX usecases using PyTIOVX tool</li>
<li>See also sample python scripts (*.py) @ "&lt;tiovx install path&gt;/tools/sample_use_cases" for additional examples</li>
</ul>
<h1><a class="anchor" id="KERNEL_SCRIPT"></a>
Kernel Generation</h1>
<dl class="section user"><dt>Example Kernel Generation Python Script</dt><dd></dd></dl>
<ul>
<li>Below is an example of a Python script used for generating a custom Channel Extract kernel: <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">from</span> tiovx <span class="keyword">import</span> *</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;code = KernelExportCode(Module.IMAGING, Core.C66, <span class="stringliteral">&quot;CUSTOM_APPLICATION_PATH&quot;</span>)</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;code.setCoreDirectory(<span class="stringliteral">&quot;c66&quot;</span>)</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;kernel = Kernel(<span class="stringliteral">&quot;channel_extract&quot;</span>)</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;kernel.setParameter(Type.IMAGE, Direction.INPUT, ParamState.REQUIRED, <span class="stringliteral">&quot;IN&quot;</span>, [<span class="stringliteral">&#39;VX_DF_IMAGE_U8&#39;</span>])</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;kernel.setParameter(Type.ENUM, Direction.INPUT, ParamState.REQUIRED, <span class="stringliteral">&quot;CHANNEL&quot;</span>)</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;kernel.setParameter(Type.IMAGE, Direction.OUTPUT, ParamState.REQUIRED, <span class="stringliteral">&quot;OUT&quot;</span>, [<span class="stringliteral">&#39;VX_DF_IMAGE_U8&#39;</span>])</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;kernel.setParameterRelationship([<span class="stringliteral">&quot;IN&quot;</span>, <span class="stringliteral">&quot;OUT&quot;</span>], [Attribute.Image.WIDTH, Attribute.Image.HEIGHT])</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;kernel.allocateLocalMemory(<span class="stringliteral">&quot;img_scratch_mem&quot;</span>, [<span class="stringliteral">&quot;width*height&quot;</span>], <span class="stringliteral">&quot;IN&quot;</span>)</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;kernel.setTarget(Target.DSP1)</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;kernel.setTarget(Target.DSP2)</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;code.export(kernel)</div>
</div><!-- fragment --></li>
<li>The constructor for the KernelExportCode API contains arguments that serve as the directory paths of the generated code.<ul>
<li>The first argument, Module.IMAGING, is the intended module of the kernel. A full list of modules are contained with the module.py file of PyTIOVX. If the name of the module needed is not listed, either the module can be added to the module.py file or the module name can be passed as a string to the constructor.</li>
<li>The second argument, Core.C66 is the specific core that this kernel will run on. Similar to the module name, a list of core values are listed in core.py. If the name of the core needed is not listed, either the core can be added to the core.py file or the core name can be passed as a string to the constructor.</li>
<li>The third argument "CUSTOM_KERNEL_PATH" is the path where the output files will be exported to.<ul>
<li>Note: this path must be set as an environment variable or else an error will be thrown.</li>
</ul>
</li>
<li>The constructor has two optional arguments, include_subpath and include_filename.<ul>
<li>The include_subpath should be set to the string value of the company name of the developer and defaults to "TI".</li>
<li>The include_filename contains the path name to the include file. By default, this value is set an empty string which results in the filepath being set to "&lt;lowercase(include_subpath)&gt;vx_&lt;module&gt;". However, the filepath can be overwritten by filling in this optional parameter.</li>
</ul>
</li>
</ul>
</li>
<li>Several dedicated API's are provided in the case that certain parameters of KernelExportCode must be changed during execution of the script. This example shows one such API, setCoreDirectory. This method can change the intended core by passing in a particular core as its only argument.</li>
<li>The constructor for the Kernel class contains as its only argument the name of the kernel to be created.</li>
<li>Parameters of a kernel are set via the setParameter API as in the example above. In this example, 3 parameters are set, an input image, an input scalar enum and an output image.</li>
<li>The following are arguments of the setParameter method:<ul>
<li>The first argument is the OpenVX data type of the parameter. Allowed values can be found in enums.py.</li>
<li>The second argument is the direction of the parameter. Allowed values are Direction.INPUT or Direction.OUTPUT.</li>
<li>The third argument determines whether the parameter is required or optional. Allowed values are ParamState.REQUIRED or ParamState.OPTIONAL.</li>
<li>The fourth argument is the name of the parameter in string format.</li>
<li>The fifth argument is optional and defines a set of allowed data types of the parameter. These are given as OpenVX data types as defined in the OpenVX 1.1 specification and are given as a comma separated list.</li>
<li>For further information, please refer to the API guide.</li>
</ul>
</li>
<li>After setting all parameters via the setParameter method, relationships among these parameters can be set via the setParameterRelationship method. This method is designed to ouput code in the validation callback to verify equality between certain attributes of parameters of the kernel. This validation of parameters is important in order no run-time errors of the kernel.</li>
<li>In this case, a relationship is set between the width and height of the "IN" and "OUT" parameters. This will produce code in the kernel validate callback that first queries the "IN" and "OUT" parameters for the width and height then checks for equality between the width of the "IN" parameter against the width of the "OUT" parameter in addition to checking for the equality between the height of the "IN" parameter against the height of the "OUT" parameter.</li>
<li>The allocateLocalMemory method is used to generate OpenVX code for allocating and free-ing local memory based on characteristics of existing data objects or on constant values. In this example, the allocateLocalMemory method is used to create a buffer with the name "img_scratch_mem" and is equal to the size of the width * height of the image, "IN". For further information, please refer to the API guide.</li>
<li>The list of targets for the kernel to run on can be set via the setTarget API. All possible targets that the kernel could run on should be given as arguments to this API. In this example, the target kernel is can be run on either DSP1 or DSP2 and therefore the setTarget API is called twice with each argument given. Allowed target values are given in enums.py.</li>
<li>Note: in the case that one of the DSP's is chosen as a potential target for the kernel to run on, a BAM version of the target kernel file is additionally outputted, along with a flag (BUILD_BAM) in the kernel registration file to build the BAM version in the case that this flag is enabled in the Makefile.</li>
<li>After setting up all parameters and targets of the kernel, the kernel wrappers can be generated by running the export method.</li>
<li>Further documentation of the API's used for kernel code generation can be found <a href="modules.html" target="_blank">here</a></li>
</ul>
<dl class="section user"><dt>Generated Kernel Code Overview</dt><dd></dd></dl>
<ul>
<li>This section describes the generated files based on the example given above.</li>
<li>Based on whether the code generation path is set to CUSTOM_KERNEL_PATH, CUSTOM_APPLICATION_PATH or VISION_APPS_PATH, the kernel files are generated in different locations.</li>
<li>The files that are generated the first time only are noted. <div class="image">
<img src="custom_kernel_path.png" alt="custom_kernel_path.png"/>
</div>
 <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;CUSTOM_KERNEL_PATH&gt;/DEVELOPER_TODO.txt (generated first time only)</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;CUSTOM_KERNEL_PATH&gt;/include/TI/tivx_imaging.h (generated first time only)</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&lt;CUSTOM_KERNEL_PATH&gt;/include/TI/tivx_imaging_kernels.h (generated first time only)</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;&lt;CUSTOM_KERNEL_PATH&gt;/include/TI/tivx_imaging_nodes.h (generated first time only)</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;&lt;CUSTOM_KERNEL_PATH&gt;/imaging/c66/concerto.mak (generated first time only)</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;&lt;CUSTOM_KERNEL_PATH&gt;/imaging/c66/vx_channel_extract_target.c</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;&lt;CUSTOM_KERNEL_PATH&gt;/imaging/c66/vx_kernels_imaging_target.c (generated first time only)</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;&lt;CUSTOM_KERNEL_PATH&gt;/imaging/c66/bam/vx_bam_channel_extract_target.c (<span class="keywordflow">if</span> using the C66 DSP)</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;&lt;CUSTOM_KERNEL_PATH&gt;/imaging/c66/bam/concerto.mak (generated first time only, <span class="keywordflow">if</span> using the C66 DSP)</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;&lt;CUSTOM_KERNEL_PATH&gt;/imaging/host/concerto.mak (generated first time only)</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;&lt;CUSTOM_KERNEL_PATH&gt;/imaging/tivx_imaging_node_api.c (generated first time only)</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;&lt;CUSTOM_KERNEL_PATH&gt;/imaging/host/vx_channel_extract_host.c</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;&lt;CUSTOM_KERNEL_PATH&gt;/imaging/host/vx_kernels_imaging_host.c (generated first time only)</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;&lt;CUSTOM_KERNEL_PATH&gt;/imaging/include/tivx_imaging_kernels.h (generated first time only)</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;&lt;CUSTOM_KERNEL_PATH&gt;/imaging/include/tivx_kernel_channel_extract.h</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;&lt;CUSTOM_KERNEL_PATH&gt;/imaging/test/concerto.mak (generated first time only)</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;&lt;CUSTOM_KERNEL_PATH&gt;/imaging/test/test_main.h (generated first time only)</div>
</div><!-- fragment --></li>
<li>If the final argument was changed to CUSTOM_APPLICATION_PATH, the following files are produced: <div class="image">
<img src="custom_application_path.png" alt="custom_application_path.png"/>
</div>
 <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;CUSTOM_APPLICATION_PATH&gt;/DEVELOPER_TODO.txt (generated first time only)</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;CUSTOM_APPLICATION_PATH&gt;/concerto_inc.mak</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&lt;CUSTOM_APPLICATION_PATH&gt;/custom_tools_path.mak</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/include/TI/tivx_imaging.h (generated first time only)</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/include/TI/tivx_imaging_kernels.h (generated first time only)</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/include/TI/tivx_imaging_nodes.h (generated first time only)</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/c66/concerto.mak (generated first time only)</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/c66/vx_channel_extract_target.c</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/c66/vx_kernels_imaging_target.c (generated first time only)</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/c66/bam/vx_bam_channel_extract_target.c (<span class="keywordflow">if</span> using the C66 DSP)</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/c66/bam/concerto.mak (generated first time only, <span class="keywordflow">if</span> using the C66 DSP)</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/host/concerto.mak (generated first time only)</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/tivx_imaging_node_api.c (generated first time only)</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/host/vx_channel_extract_host.c</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/host/vx_kernels_imaging_host.c (generated first time only)</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/include/tivx_imaging_kernels.h (generated first time only)</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/include/tivx_kernel_channel_extract.h</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/test/concerto.mak (generated first time only)</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/test/test_main.h (generated first time only)</div>
</div><!-- fragment --></li>
<li>If the final argument was changed to VISION_APPS_PATH, the following files are produced: <div class="image">
<img src="vision_apps_path.png" alt="vision_apps_path.png"/>
</div>
 <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;VISION_APPS_PATH&gt;/kernels/DEVELOPER_TODO.txt (generated first time only)</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;VISION_APPS_PATH&gt;/kernels/imaging/include/TI/tivx_imaging.h (generated first time only)</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&lt;VISION_APPS_PATH&gt;/kernels/imaging/include/TI/tivx_imaging_kernels.h (generated first time only)</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;&lt;VISION_APPS_PATH&gt;/kernels/imaging/include/TI/tivx_imaging_nodes.h (generated first time only)</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;&lt;VISION_APPS_PATH&gt;/kernels/imaging/c66/concerto.mak (generated first time only)</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;&lt;VISION_APPS_PATH&gt;/kernels/imaging/c66/vx_channel_extract_target.c</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;&lt;VISION_APPS_PATH&gt;/kernels/imaging/c66/vx_kernels_imaging_target.c (generated first time only)</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;&lt;VISION_APPS_PATH&gt;/kernels/imaging/c66/bam/vx_bam_channel_extract_target.c (<span class="keywordflow">if</span> using the C66 DSP)</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;&lt;VISION_APPS_PATH&gt;/kernels/imaging/c66/bam/concerto.mak (generated first time only, <span class="keywordflow">if</span> using the C66 DSP)</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;&lt;VISION_APPS_PATH&gt;/kernels/imaging/host/concerto.mak (generated first time only)</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;&lt;VISION_APPS_PATH&gt;/kernels/imaging/tivx_imaging_node_api.c (generated first time only)</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;&lt;VISION_APPS_PATH&gt;/kernels/imaging/host/vx_channel_extract_host.c</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;&lt;VISION_APPS_PATH&gt;/kernels/imaging/host/vx_kernels_imaging_host.c (generated first time only)</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;&lt;VISION_APPS_PATH&gt;/kernels/imaging/include/tivx_imaging_kernels.h (generated first time only)</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;&lt;VISION_APPS_PATH&gt;/kernels/imaging/include/tivx_kernel_channel_extract.h</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;&lt;VISION_APPS_PATH&gt;/kernels/imaging/test/concerto.mak (generated first time only)</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;&lt;VISION_APPS_PATH&gt;/kernels/imaging/test/test_main.h (generated first time only)</div>
</div><!-- fragment --></li>
<li>As noted, the majority of the generated files are only generated once per kernel module. These files contain boilerplate code needed for registering/unregistering the new kernels and node creation.</li>
<li>In the case that the module already exists, code will simply be appended to the existing files rather than duplicating any previously generated files.</li>
</ul>
<dl class="section user"><dt>Overview of Necessary Kernel Code Modifications</dt><dd></dd></dl>
<ul>
<li>In addition to the code generated by the python script, a text file called "DEVELOPER_TODO.txt" is generated that provides information regarding the changes to be made to the generated files.</li>
<li>The two files wherein most modifications will occur are the host and target kernel files. The files for the given example are listed below: <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/c66/vx_channel_extract_target.c</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/host/vx_channel_extract_host.c</div>
</div><!-- fragment --></li>
<li>The host kernel file must be modified in the following ways:<ul>
<li>Validate callback: Additional custom parameter checking may need to be added to the validate callback. The script will generate parameter checking for attributes of parameters that are equal. Additional checking beyond the scope of the script must be entered in manually by the user. For example, in the case of a kernel with a scaled output, the validate callback should verify that the output is dimensions are scaled properly from the input. This type of check will most likely first require querying a given kernel parameter as specified by the OpenVX API designated for querying the given parameter. At this point the value can be verified against a known quantity. This step of proper validation catches errors during the verification stage and is important within the context of OpenVX to ensure no errors during execution of the graph.</li>
<li>Initialize callback: Appropriate valid region padding values must be added to the initialize callback to support the UNDEFINED border mode in the case that the data type in question is an image. These values will be determined by whether or not the generated kernel contains a region-based operation. For example, in the case that the kernel in question is a 3x3 filter, the padding for the top, bottom, left and right will all be a value of '1'. In the case that no region-based operations are performed, these values can be set to '0'.</li>
</ul>
</li>
<li>The target kernel file must be modified in the following ways:<ul>
<li>Create callback: The create callback is run once upon verification of the graph and should include allocation of any required local memory buffers as well as any one time initialization required for the kernel.</li>
<li>Delete callback: The delete callback is run upon release of the graph and should include the freeing of local memory buffers that were allocated within the create callback as well as any deinitialization of parameters that were initialized in the create callback.</li>
<li>Process callback: The process callback is run upon each execution of the graph and should include a call to the kernel process function. For example, in the case of OpenVX core kernels, the process callback contains a call to the optimized VXLIB function that performs the operation of the kernel.</li>
<li>Control callback: The control callback is run upon a user command to the kernel at run-time. It should include the processing of this user command and the operation necessary to modify the operation of the kernel.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="USE_CASE_SCRIPT"></a>
Use Case Generation</h1>
<dl class="section user"><dt>Example Use Case Generation Python Script</dt><dd></dd></dl>
<ul>
<li>In addition to generating kernel wrappers, the Python script also provides the ability to generate full use cases consisting of existing nodes. The Python script will generate all of the necessary OpenVX-related function calls at a fraction of the amount of code.</li>
<li>In addition to generating OpenVX code, the Python tool also has the ability to generate an image capturing the nodes and connections within the OpenVX graph. This allows the developer to better visualize the functionality of the graph.</li>
<li>Several examples are given as a part of the TIOVX release at the location tiovx/tools/sample_use_cases. Particularly, the file "uc_sample_07.py" gives an in-depth look at the extent of the tool by providing a superset of the data types as well as showing how a good portion of the nodes are called.</li>
<li>An example is given below of how to generate OpenVX code using the Python tool. This example consists of two nodes, a table lookup node and a convolution node. The next section will describe the generated OpenVX code from this example. <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">from</span> tiovx <span class="keyword">import</span> *</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;context = Context(<span class="stringliteral">&quot;uc_sample_07&quot;</span>)</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;graph = Graph()</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;img_in = Image(640, 480, DfImage.U8)</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;img_out_lut = Image(640, 480, DfImage.U8)</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;lut = Lut(Type.UINT8, 255)</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;node_lut = NodeTableLookup(img_in, lut, img_out_lut);</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;img_out_conv = Image(640, 480, DfImage.S16)</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;conv = Convolution(3, 3)</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;node_conv = NodeConvolve(img_out_lut, conv, img_out_conv, target=Target.DSP2);</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;graph.add ( node_lut )</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;graph.add ( node_conv )</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;context.add ( graph )</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;ExportImage(context).export()</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;ExportCode(context, <span class="stringliteral">&quot;VISION_APPS_PATH&quot;</span>).export()</div>
</div><!-- fragment --></li>
<li>Further documentation of the API's used for use case generation can be found <a href="modules.html" target="_blank">here</a></li>
</ul>
<dl class="section user"><dt>Generated Use Case Code Overview</dt><dd></dd></dl>
<ul>
<li>For the above Python script, a set of use case-specific files get generated. In the default case, the exported code gets generated at the "VISION_APPS_PATH". The intent of generating use cases along this path is to build the use case as a part of the vision_apps project. A list of the generated files can be seen below: <div class="image">
<img src="vapps_path2.png" alt="vapps_path2.png"/>
</div>
 <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;VISION_APPS_PATH&gt;/apps/uc_sample_07/DEVELOPER_TODO.txt</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;VISION_APPS_PATH&gt;/apps/uc_sample_07/concerto_inc.mak</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&lt;VISION_APPS_PATH&gt;/apps/uc_sample_07/app_uc_sample_07/concerto.mak</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;&lt;VISION_APPS_PATH&gt;/apps/uc_sample_07/app_uc_sample_07/uc_sample_07.c</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;&lt;VISION_APPS_PATH&gt;/apps/uc_sample_07/app_uc_sample_07/uc_sample_07.h</div>
</div><!-- fragment --></li>
<li>The other supported export path is the CUSTOM_APPLICATION_PATH. The intent of generating use cases along this path is to build the use case as a part of the tiovx project. A list of generated files using this path with the above script can be seen below. Note: a few additional files are generated in this case in order for it to be included in the tiovx build. <div class="image">
<img src="custom_application_path_use_case.png" alt="custom_application_path_use_case.png"/>
</div>
 <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;CUSTOM_APPLICATION_PATH&gt;/DEVELOPER_TODO.txt</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;CUSTOM_APPLICATION_PATH&gt;/concerto_inc.mak</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&lt;CUSTOM_APPLICATION_PATH&gt;/custom_tools_path.mak</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/custom_app_kernel_library_tests.h</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;&lt;CUSTOM_APPLICATION_PATH&gt;/app_uc_sample_07/concerto.mak</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;&lt;CUSTOM_APPLICATION_PATH&gt;/app_uc_sample_07/uc_sample_07.c</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;&lt;CUSTOM_APPLICATION_PATH&gt;/app_uc_sample_07/uc_sample_07.h</div>
</div><!-- fragment --></li>
<li>The top-level function prototypes generated by the use case generation script can be seen below: <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;vx_status uc_sample_07_create(uc_sample_07 usecase);</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;vx_status uc_sample_07_delete(uc_sample_07 usecase);</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;vx_status uc_sample_07_verify(uc_sample_07 usecase);</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;vx_status uc_sample_07_run(uc_sample_07 usecase);</div>
</div><!-- fragment --></li>
<li>The functions listed above can be called from a main function in sequential order upon successful return in order to run the OpenVX graph.<ul>
<li>The create function simply allocates all memory and data objects for the graph and performs any necessary initialization.</li>
<li>The verify function calls the vxVerifyGraph API to ensure that all parameters of the graph are correct.</li>
<li>The run function simply executes the graph once upon each call.</li>
<li>The delete function frees all memory and performs deinitialization.</li>
</ul>
</li>
<li>The tutorial provided at tiovx/tutorial provides sample code of how to link these functions to a main function.</li>
<li>The following code snippet shows the creation of the data used in the use case generation script. <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;vx_status uc_sample_07_data_create(uc_sample_07 usecase)</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;{</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    vx_status status = VX_SUCCESS;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    vx_context context = usecase-&gt;context;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    <span class="keywordflow">if</span> (status == VX_SUCCESS)</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    {</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;        usecase-&gt;image_1 = vxCreateImage(context, 640, 480, VX_DF_IMAGE_U8);</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;        <span class="keywordflow">if</span> (usecase-&gt;image_1 == NULL)</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;        {</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;            status = VX_ERROR_NO_RESOURCES;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;        }</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;        vxSetReferenceName( (vx_reference)usecase-&gt;image_1, <span class="stringliteral">&quot;image_1&quot;</span>);</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    }</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    <span class="keywordflow">if</span> (status == VX_SUCCESS)</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    {</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;        usecase-&gt;lut_3 = vxCreateLUT(context, VX_TYPE_UINT8, 255);</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;        <span class="keywordflow">if</span> (usecase-&gt;lut_3 == NULL)</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;        {</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;            status = VX_ERROR_NO_RESOURCES;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;        }</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    }</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    <span class="keywordflow">if</span> (status == VX_SUCCESS)</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    {</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        usecase-&gt;image_2 = vxCreateImage(context, 640, 480, VX_DF_IMAGE_U8);</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;        <span class="keywordflow">if</span> (usecase-&gt;image_2 == NULL)</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;        {</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;            status = VX_ERROR_NO_RESOURCES;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;        }</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        vxSetReferenceName( (vx_reference)usecase-&gt;image_2, <span class="stringliteral">&quot;image_2&quot;</span>);</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    }</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="keywordflow">if</span> (status == VX_SUCCESS)</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    {</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        usecase-&gt;convolution_6 = vxCreateConvolution(context, 3, 3);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        <span class="keywordflow">if</span> (usecase-&gt;convolution_6 == NULL)</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        {</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;            status = VX_ERROR_NO_RESOURCES;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        }</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    }</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordflow">if</span> (status == VX_SUCCESS)</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    {</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        usecase-&gt;image_5 = vxCreateImage(context, 640, 480, VX_DF_IMAGE_S16);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        <span class="keywordflow">if</span> (usecase-&gt;image_5 == NULL)</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        {</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;            status = VX_ERROR_NO_RESOURCES;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        }</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        vxSetReferenceName( (vx_reference)usecase-&gt;image_5, <span class="stringliteral">&quot;image_5&quot;</span>);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    }</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keywordflow">return</span> status;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;}</div>
</div><!-- fragment --></li>
<li>As the above code snippet indicates, the PyTIOVX use case generation tool encapsulates a large amount of OpenVX code in very few lines of Python code. The OpenVX generated code also provides error checking in the event that the data objects were unable to be created.</li>
<li>The following code snippet shows the functions used for creating the nodes corresponding to the use case generation script. <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;static vx_node usecase_node_create_node_4 (</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  vx_graph graph ,</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  vx_image image_0 ,</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  vx_lut lut_1 ,</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  vx_image image_2 </div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  )</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;{</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    vx_node node = NULL;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    vx_reference params[] =</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    {</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;          (vx_reference)image_0 ,</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;          (vx_reference)lut_1 ,</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;          (vx_reference)image_2 </div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    };</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    node = tivxCreateNodeByKernelEnum(graph, VX_KERNEL_TABLE_LOOKUP, params, 3);</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    <span class="keywordflow">return</span> node;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;}</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;static vx_node usecase_node_create_node_7 (</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  vx_graph graph ,</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;  vx_image image_0 ,</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  vx_convolution convolution_1 ,</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  vx_image image_2 </div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  )</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;{</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    vx_node node = NULL;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    vx_reference params[] =</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    {</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;          (vx_reference)image_0 ,</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;          (vx_reference)convolution_1 ,</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;          (vx_reference)image_2 </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    };</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    node = tivxCreateNodeByKernelEnum(graph, VX_KERNEL_CUSTOM_CONVOLUTION, params, 3);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keywordflow">return</span> node;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;}</div>
</div><!-- fragment --></li>
<li>As the above code snippet shows, the nodes for the use case are created by first passing the corresponding data objects to a function the creating the node by enum. This process is how any given node is created using the script.</li>
<li>The following code snippet shows the generated OpenVX code for the verification and run steps. <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;vx_status uc_sample_07_graph_0_verify(uc_sample_07 usecase)</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;{</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    vx_status status = VX_SUCCESS;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    vx_graph graph = usecase-&gt;graph_0;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    <span class="keywordflow">if</span> (status == VX_SUCCESS)</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    {</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;        status = vxVerifyGraph(graph);</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    }</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    <span class="keywordflow">return</span> status;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;}</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;vx_status uc_sample_07_graph_0_run(uc_sample_07 usecase)</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;{</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    vx_status status = VX_SUCCESS;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    vx_graph graph = usecase-&gt;graph_0;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    <span class="keywordflow">if</span> (status == VX_SUCCESS)</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    {</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        status = vxProcessGraph(graph);</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    }</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <span class="keywordflow">return</span> status;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;}</div>
</div><!-- fragment --></li>
<li>The code snippet above is generated for every use case.<ul>
<li>The first function simply performs verification on the graph and returns the status of verification.</li>
<li>The second function runs the graph by executing vxProcessGraph. In the case that the use case requires streaming, this function can be executed in an infinite loop.</li>
</ul>
</li>
<li>For further information on this use case, the entire file can be found at tiovx/tools/sample_use_cases/uc_sample_07.c.</li>
</ul>
<dl class="section user"><dt>Using PyTIOVX to create a use case with a user kernel</dt><dd></dd></dl>
<ul>
<li>The PyTIOVX tool can also be used to generate use cases with user kernels as nodes of the graph. The following example describes the necessary steps in this process.</li>
<li>The following PyTIOVX script produces a simple user kernel wrapper with a single input image and a single output image. These images have equivalent widths heights and are set to run on both DSP1 and DSP2. In this example, the functionality of the kernel will be a simple copy from input to output. <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">from</span> tiovx <span class="keyword">import</span> *</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;code = KernelExportCode(<span class="stringliteral">&quot;TI&quot;</span>, <span class="stringliteral">&quot;presentation&quot;</span>, <span class="stringliteral">&quot;presentation_module&quot;</span>, <span class="stringliteral">&quot;c66x&quot;</span>, <span class="stringliteral">&quot;CUSTOM_KERNEL_PATH&quot;</span>)</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;kernel = Kernel(<span class="stringliteral">&quot;presentation_example&quot;</span>)</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;kernel.setParameter(Type.IMAGE, Direction.INPUT, ParamState.REQUIRED, <span class="stringliteral">&quot;IN&quot;</span>, [<span class="stringliteral">&#39;VX_DF_IMAGE_U8&#39;</span>])</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;kernel.setParameter(Type.IMAGE, Direction.OUTPUT, ParamState.REQUIRED, <span class="stringliteral">&quot;OUT&quot;</span>, [<span class="stringliteral">&#39;VX_DF_IMAGE_U8&#39;</span>])</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;kernel.setParameterRelationship([<span class="stringliteral">&quot;IN&quot;</span>, <span class="stringliteral">&quot;OUT&quot;</span>], [Attribute.Image.WIDTH, Attribute.Image.HEIGHT])</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;kernel.setTarget(Target.DSP1)</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;kernel.setTarget(Target.DSP2)</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;code.export(kernel)</div>
</div><!-- fragment --></li>
<li>After running the previous script, the next step is to create a use case generation PyTIOVX script that includes the newly created user kernel. An example of this can be found at tiovx/tutorial/ch03_graph/vx_tutorial_graph_user_kernel_pytiovx_uc.py.</li>
<li>Minimal modifications to this script are needed to incorporate the previously discussed user kernel.<ul>
<li>The first modification to be made is to change the name of the node to match the name given to the user kernel. In this case, the node name is NodePresentationExample.</li>
<li>The next simple modification to be made is to replace the existing kernel string with the kernel string produced by the kernel generation script. In this case, the kernel string is "com.ti.presentation_module.presentation_example".</li>
<li>Finally, slight modifications must be made to the checkParams method of the Node class based on the kernel parameters' relationships.</li>
</ul>
</li>
<li>The resulting PyTIOVX script can be seen below: <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">from</span> tiovx <span class="keyword">import</span> *</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">class </span>NodePresentationExample (Node) :</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    <span class="keyword">def </span>__init__(self, image_in, image_out, name=&quot;default&quot;, target=Target.DEFAULT) :</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;        Node.__init__(self, <span class="stringliteral">&quot;com.ti.presentation_module.presentation_example&quot;</span>, image_in, image_out)</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;        self.setParams(1, 1, Type.IMAGE, Type.IMAGE)</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;        self.setTarget(target)</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;        self.setKernelEnumName(<span class="stringliteral">&quot;VX_USER_KERNEL&quot;</span>)</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    <span class="keyword">def </span>checkParams(self, *param_type_args) :</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;        Node.checkParams(self, *param_type_args)</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;        <span class="keyword">assert</span> ( self.ref[0].width    == self.ref[1].width ), <span class="stringliteral">&quot;Input and Output width MUST match&quot;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;        <span class="keyword">assert</span> ( self.ref[0].height   == self.ref[1].height ), <span class="stringliteral">&quot;Input and Output height MUST match&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;        <span class="keyword">assert</span> ( self.ref[0].df_image == self.ref[1].df_image ), <span class="stringliteral">&quot;Input data format and output data format must match&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;        <span class="keyword">assert</span> ( self.ref[1].df_image == DfImage.U8 ), <span class="stringliteral">&quot;Data format must be U8&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="keyword">def </span>make_my_graph() :</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    context = Context(<span class="stringliteral">&quot;uc_sample_08&quot;</span>)</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    graph = Graph()</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    width = 640</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    height = 480</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    in_image = Image(width, height, DfImage.U8, name=<span class="stringliteral">&quot;in&quot;</span>)</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    out_image = Image(width, height, DfImage.U8, name=<span class="stringliteral">&quot;out&quot;</span>)</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    graph.add ( NodePresentationExample(in_image, out_image, target=Target.DSP1) )</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    context.add ( graph )</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    ExportImage(context).export()</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    ExportCode(context).export()</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;make_my_graph()</div>
</div><!-- fragment --></li>
</ul>
<p><br/>
 </p>
<hr/>
<dl class="section user"><dt>Disclaimer</dt><dd></dd></dl>
<p>See also <a class="el" href="TI_DISCLAIMER.html">TI Disclaimer</a>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
