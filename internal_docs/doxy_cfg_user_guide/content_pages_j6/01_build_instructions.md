# TIOVX Build & Run Instructions {#BUILD_INSTRUCTIONS}

[TOC]

# Build instructions for Vision SDK Platform (TDA2x/3x/2Ex) {#BUILD_VSDK}

## Requirements
  - Install Vision SDK vXX.XX.XX.XX as mentioned in the TIOVX release notes
    - This will install all packages needed to build Vision SDK
    - This will also install TIOVX, VXLIB and other OpenVX related packages

## Setup
  - Edit $TIOVX_PATH/vsdk_tools_path.mak, modify paths for various dependant packages if required.
    - NOTE: When Vision SDK is installed, all paths in this file
      would be setup to point to correct locations within the Vision SDK installation.
  - For windows build environment,
    - Make sure "xdctools_x_xx_xx_xx_core/bin/gmake" available as part
      of XDC package (included in Vision SDK) is visible in the system path.
  - Edit $TIOVX_PATH/build_flags_vsdk.mak
    - set BUILD_EMULATION_MODE=no and BUILD_TARGET_MODE=yes

## Build
  - Open a command prompt at $TIOVX_PATH
  - Type below commands to build TIOVX and associated libraries,
    On Linux,
    \code
     make
    \endcode
    On Windows,
    \code
     gmake
    \endcode
    - This builds the TIOVX libraries and copies the libraries to $TIOVX_PATH/lib folder
    - Conformance test and tutorial is built as a library
  - The final Vision SDK executable with the OpenVX conformance test, tutorial
    needs to be build from Vision SDK folder
  - Steps to build Vision SDK, (OpenVX is enabled by default in Vision SDK)
    - In vision_sdk/build/Rules.make
      - set MAKECONFIG to one of below based on yor SoC/EVM
        - set MAKECONFIG=tda2xx_evm_bios_all  # For TDA2x  BIOS ONLY
        - set MAKECONFIG=tda2ex_evm_bios_all  # For TDA2Ex BIOS ONLY
        - set MAKECONFIG=tda3xx_evm_bios_all  # For TDA3x  BIOS ONLY
        - set MAKECONFIG=tda2xx_evm_linux_all # For TDA2x  Linux+BIOS
        - set MAKECONFIG=tda2ex_evm_linux_all # For TDA2Ex Linux+BIOS
      - set PROFILE to one of below
        - debug
        - release [default]
    - Build Vision SDK and bootloader by following steps in appropiate SoC/EVM User Guide in Vision SDK
      - Typical Vision SDK build steps are (refer user guide for details)
        \code
        make linux         # for LINUX+BIOS config, build linux kernel, uboot, kernel modules
        make linux_install # for LINUX+BIOS config, install kernel modules to linux filesystem
        make -s -j depend  # build drivers and other dependancies
        make -s -j         # build Vision SDK application binary
        make -s sbl        # for BIOS config only, build SBL (secondary bootloader)
        make -s appimage   # for BIOS config only, make SBL bootable application binary
        \endcode
    - When Vision SDK is built, it will link against the tiovx related libraries

## Running the conformance test and tutorial (for BIOS ONLY config)
  - Flash/copy the Vision SDK bootloader, "AppImage" and setup the EVM as mentioned in SoC/EVM User Guide in Vision SDK
  - Copy the test data used in conformance test to an SD card
    - Copy all files and folders from "$TIOVX_PATH\conformance_tests\test_data"
      to "test_data" folder in SD card
  - Boot the EVM, with the SD card inserted and use the menu in UART terminal to navigate to the OpenVX
    use-cases and run the conformance test, tutorial
  - NOTE: Output .bmp files generated by the tutorial will be present in SD card in the folder "test_data"

## Running the Camera+Display with OpenVX use-case (for BIOS ONLY config)
  - Flash/copy the Vision SDK bootloader, "AppImage" and setup the EVM as mentioned in SoC/EVM User Guide in Vision SDK
  - Connect a OV10635 sensor to the EVM as mentioned in SoC/EVM User Guide in Vision SDK
  - Connect a HDMI Display to the EVM as mentioned in SoC/EVM User Guide in Vision SDK
  - Boot the EVM, with the SD card inserted and use the menu in UART terminal to navigate to the OpenVX
    use-cases and run the "VIP Single Channel Capture + OpenVX + Display" option

## Running the conformance test and tutorial (for LINUX+BIOS config)
  - Copy all files and folders from "$TIOVX_PATH\conformance_tests\test_data"
      to Linux filesystem at "/opt/openvx/test_data"
  - Do the below steps as mentioned in Vision SDK user guide
    - Flash the linux kernel, uboot, filesystem to SD card
    - Boot the EVM
    - At the linux command prompt set path of test data as shown below
      - export VX_TEST_DATA_PATH=/opt/openvx/test_data
    - Run the Vision SDK demo application
  - Use the menu in UART terminal to navigate to the OpenVX use-cases and run the conformance test, tutorial
  - NOTE: Output .bmp files generated by the tutorial will be present in filesystem in the folder $VX_TEST_DATA_PATH

---

# Build instructions for x86 Linux Platform (HOST Emulation Mode) {#BUILD_LINUX}

## Requirements
  - GCC and Linux
    - Currently the build is tested with Ubuntu 14.04 and 18.04
    - Make sure GCC v5 or higer is installed and visible in your system path
    - Make sure GNU make is installed and visible in your system path
    - GCC compiler with 32b mode support is required for using TIOVX
      - Make sure below linux packages are installed. This is requiered to use GCC in 32b
        mode on 64b systems.
        \code
        sudo apt-get install g++-5-multilib libc6 libc6-dev
        \endcode

## Setup
  - Edit $TIOVX_PATH/vsdk_tools_path.mak
    - Modify "GCC_LINUX_ROOT := /usr/" to match your environment if needed
    - The following paths are the only paths that must be set correctly for host emulation mode. (If paths have been already set for build for Vision SDK Platform, they do not need to be changed.)
      - VXLIB_PATH
      - DMAUTILS_PATH (must only be set if BUILD_BAM option is enabled)
      - ALGFRAMEWORK_PATH (must only be set if BUILD_BAM option is enabled)
      - EVE_SW_PATH (must only be set if BUILD_IVISION_KERNELS is enabled)
  - Edit $TIOVX_PATH/Makefile
    - set BUILD_EMULATION_MODE=yes and BUILD_TARGET_MODE=no

## Build
  - Open a command prompt at $TIOVX_PATH
  - Type "make" to build TIOVX and associated libraries
    - This builds the TIOVX libraries, conformance test, and tutorial executables
    - This uses pre-built library for VXLIB, DMAUtils, Algframework from "$TIOVX_PATH\lib\PC\X86\LINUX\$PROFILE\*.a"
    - The pre-built libraries are compiled in 32bit x86 host emulation mode
  - Conformance test, tutorial executable is output at
    - "$TIOVX_PATH\out\PC\X86\LINUX\debug\vx_conformance_tests_exe"
    - "$TIOVX_PATH\out\PC\X86\LINUX\debug\vx_tutorial_exe"

## Running the conformance test and tutorial
  - Open a command prompt at the folder "$TIOVX_PATH/out/PC/X86/LINUX/$PROFILE/"
  - Set environment variable below to specify the path of the test data. This is used by both
    the conformance test and tutorial executables
    \code
    export VX_TEST_DATA_PATH=../../../../../conformance_tests/test_data
    \endcode
  - Execute "./vx_conformance_tests_exe" to run the conformance test
  - Execute "./vx_tutorial_exe" to run the tutorial
  - NOTE: Output .bmp/.png files generated by the tutorial will be present in the folder $VX_TEST_DATA_PATH

---

# Makefile build options (found in Makefile and/or build_flags_vsdk.mak) {#BUILD_OPTIONS}

## Build Options

Build Option                         | Description | Default Setting |
-------------------------------------|-------------|-----------------|
PROFILE                        | Determines which profile to build for <BR> Valid values are: <BR> release, debug, all  | all |
BUILD_EMULATION_MODE           | Builds PC emulation mode | no |
BUILD_TARGET_MODE              | Builds for target SoC platform like TDAxx | yes |
BUILD_CONFORMANCE_TEST  | Builds entire test suite executable  | yes |
BUILD_IVISION_KERNELS   | Builds iVision kernels (EVE_SW_PATH required to be set for this build)  | yes |
BUILD_BAM               | Builds DMA wrapper (DMAUTILS_PATH and ALGFRAMEWORK_PATH required to be set for this build)  | yes |
BUILD_TUTORIAL          | Builds OpenVX tutorial  | yes |
BUILD_LINUX_A15         | Builds for A15 Linux target  | yes |
BUILD_EVE               | Builds for EVE platform (ARP32CGT_ROOT and EVE_SW_PATH required to be set for this build)  | yes |
BUILD_SDK               | Builds for Vision SDK SW platform (TDA2x/3x/2Ex) or Processor SDK SW platform (AM57xx). <BR> Valid values are, <BR> vsdk for Vision SDK SW platform <BR> psdk for Processor SDK SW platform | vsdk |
BUILD_IGNORE_LIB_ORDER  | When set to yes, it ignores the static library order listed in makefiles when building on the PC. | yes |
BUILD_CT_KHR  | Builds and includes the Khronos OpenVX 1.1 conformance tests suite.  | yes |
BUILD_CT_TIOVX  | Builds and includes the TI-added tests suite (for TI extensions and additional rohbustness testing).  | yes |
BUILD_CT_TIOVX_TEST_KERNELS  | Builds and includes the TI-added tests suite (for testing custom kernel interface). | yes |
BUILD_CT_TIOVX_IVISION  | Builds and includes the tests for IVISION kernels test suite.       | yes |
BUILD_CT_TIOVX_TIDL  | Builds and includes the tests for TIDL kernel test suite.     | yes |
BUILD_CT_TIOVX_HWA  | Builds and includes the tests for HWA kernels test suite.      | no |

---

# Deleting all generated files {#BUILD_CLEAN}

 - To do a clean build, do "(g)make clean"
 - To manually delete generated files do below
    \code
    Delete directory out/
    \endcode
